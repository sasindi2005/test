<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SafePaws.lk | Veterinary Workspace</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['"Plus Jakarta Sans"', 'sans-serif'] },
                    colors: {
                        brand: {
                            dark: '#020617',
                            card: '#0f172a',
                            accent: '#0ea5e9', // Sky Blue
                            secondary: '#6366f1' // Indigo
                        }
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'float': 'float 6s ease-in-out infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    }
                }
            }
        }
    </script>

    <style type="text/tailwindcss">
        @layer utilities {
            /* Advanced Glassmorphism */
            .glass-nav {
                @apply bg-[#020617]/80 backdrop-blur-xl border-b border-white/10;
            }
            .glass-panel {
                @apply bg-[#0f172a]/60 backdrop-blur-xl border border-white/10 shadow-xl;
            }
            .glass-card {
                @apply bg-white/5 backdrop-blur-md border border-white/5 rounded-2xl hover:bg-white/10 transition-all duration-300;
            }
            
            /* Inputs */
            .input-field {
                @apply w-full bg-[#020617]/50 border border-slate-700 text-slate-100 rounded-xl px-4 py-3 text-sm focus:outline-none focus:border-sky-500 focus:ring-1 focus:ring-sky-500 transition-all placeholder-slate-500;
            }
            .input-label {
                @apply block text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2;
            }

            /* Navigation Links */
            .nav-link {
                @apply px-4 py-2 text-sm font-medium text-slate-400 hover:text-white hover:bg-white/5 rounded-lg transition-all flex items-center gap-2;
            }
            .nav-link.active {
                @apply text-sky-400 bg-sky-500/10 border border-sky-500/20;
            }

            /* Scrollbar */
            ::-webkit-scrollbar { width: 6px; }
            ::-webkit-scrollbar-track { background: #020617; }
            ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
            ::-webkit-scrollbar-thumb:hover { background: #475569; }

            /* Animations */
            .recording-pulse {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
                animation: pulse-red 1.5s infinite cubic-bezier(0.66, 0, 0, 1);
            }
        }

        @keyframes pulse-red {
            to { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
        }
        
        body { background-color: #020617; color: #f8fafc; }
        
        /* Background Ambient Glow */
        .glow-blob {
            position: absolute;
            width: 500px;
            height: 500px;
            background: radial-gradient(circle, rgba(14,165,233,0.15) 0%, rgba(0,0,0,0) 70%);
            border-radius: 50%;
            pointer-events: none;
            z-index: -1;
        }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden relative">

    <div class="glow-blob top-0 left-0 animate-float"></div>
    <div class="glow-blob bottom-0 right-0 bg-purple-500/10 animate-float" style="animation-delay: 2s"></div>

    <nav class="h-16 glass-nav z-50 flex items-center justify-between px-6 shrink-0">
        <div class="flex items-center gap-8">
            <div class="flex items-center gap-2 text-sky-500 font-bold tracking-tight text-xl">
                <svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" /></svg>
                SafePaws<span class="text-white">.lk</span>
            </div>

            <div class="hidden md:flex items-center gap-2">
                <a href="#" class="nav-link">Dashboard</a>
                <a href="#" class="nav-link">Appointments</a>
                <a href="#" class="nav-link active">
                    <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
                    Records
                </a>
                <a href="#" class="nav-link">Inventory</a>
                <a href="#" class="nav-link">Finances</a>
            </div>
        </div>

        <div class="flex items-center gap-4">
            <div class="hidden lg:flex items-center gap-1 text-xs text-slate-500 border-r border-white/10 pr-4 mr-2">
                <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                Colombo, LK
            </div>

            <button class="relative p-2 text-slate-400 hover:text-white transition">
                <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" /></svg>
                <span class="absolute top-1.5 right-1.5 w-2 h-2 bg-red-500 rounded-full border border-[#020617]"></span>
            </button>

            <div class="flex items-center gap-3 pl-4 border-l border-white/10 cursor-pointer group">
                <div class="text-right hidden sm:block">
                    <div class="text-sm font-medium text-white group-hover:text-sky-400 transition">Dr. Aravinda</div>
                    <div class="text-xs text-slate-500">Chief Veterinarian</div>
                </div>
                <div class="w-9 h-9 rounded-full bg-gradient-to-tr from-sky-500 to-indigo-500 flex items-center justify-center text-sm font-bold text-white shadow-lg ring-2 ring-transparent group-hover:ring-sky-500/50 transition">
                    AP
                </div>
            </div>
        </div>
    </nav>

    <div class="flex flex-1 overflow-hidden">
        
        <aside class="w-full md:w-80 border-r border-white/5 bg-[#0f172a]/40 flex flex-col h-full z-20 overflow-y-auto">
            <div class="p-6 border-b border-white/5">
                <div class="text-xs font-bold text-slate-500 uppercase tracking-wider mb-4">Patient Profile</div>
                
                <div class="relative group">
                    <img src="https://images.unsplash.com/photo-1583511655857-d19b40a7a54e?auto=format&fit=crop&w=300&q=80" class="w-full h-48 object-cover rounded-2xl shadow-lg mb-4 filter brightness-90 group-hover:brightness-100 transition" alt="Patient">
                    <div class="absolute top-3 right-3 bg-emerald-500/20 text-emerald-400 border border-emerald-500/30 px-2 py-1 rounded-lg text-xs font-bold backdrop-blur-md">
                        In Consultation
                    </div>
                </div>

                <h2 class="text-2xl font-bold text-white">Rusty</h2>
                <p class="text-slate-400 text-sm mb-3">Golden Retriever ‚Ä¢ 5 Years ‚Ä¢ Male</p>
                
                <div class="flex flex-wrap gap-2 mb-4">
                    <span class="px-2 py-1 rounded bg-rose-500/10 text-rose-400 border border-rose-500/20 text-xs">‚ö†Ô∏è Penicillin Allergy</span>
                    <span class="px-2 py-1 rounded bg-blue-500/10 text-blue-400 border border-blue-500/20 text-xs">üìç Colombo 07</span>
                </div>

                <div class="bg-white/5 rounded-xl p-4 border border-white/5">
                    <div class="text-xs text-slate-400 mb-2 uppercase">Owner Details</div>
                    <div class="font-medium text-white">Mr. Kamal Perera</div>
                    <div class="text-sm text-slate-400">+94 77 123 4567</div>
                    <div class="text-sm text-slate-400">No. 15, Ward Place, Colombo</div>
                </div>
            </div>

            <div class="p-6 flex-1">
                <h3 class="input-label mb-4">Medical History</h3>
                <div class="space-y-3">
                    <div class="glass-card p-3 flex justify-between items-center cursor-pointer">
                        <div>
                            <div class="text-sm font-medium">Routine Vaccination</div>
                            <div class="text-xs text-slate-500">12 Oct 2024 ‚Ä¢ Dr. Silva</div>
                        </div>
                        <div class="w-2 h-2 rounded-full bg-green-500"></div>
                    </div>
                    <div class="glass-card p-3 flex justify-between items-center cursor-pointer">
                        <div>
                            <div class="text-sm font-medium">Skin Infection</div>
                            <div class="text-xs text-slate-500">15 Aug 2024 ‚Ä¢ Dr. Aruni</div>
                        </div>
                        <div class="w-2 h-2 rounded-full bg-yellow-500"></div>
                    </div>
                </div>
                
                <div class="mt-6">
                    <h3 class="input-label">Weight History (KG)</h3>
                    <div class="h-32 w-full">
                        <canvas id="weightChart"></canvas>
                    </div>
                </div>
            </div>
        </aside>

        <main class="flex-1 flex flex-col h-full overflow-hidden relative">
            
            <header class="h-14 border-b border-white/5 bg-[#020617]/40 backdrop-blur-sm flex items-center justify-between px-8 sticky top-0 z-30 shrink-0">
                <div class="flex items-center gap-4">
                    <span class="text-slate-400 text-sm">Consultation ID: <span class="text-white font-mono">#SP-2025-892</span></span>
                    <span class="h-4 w-px bg-white/10"></span>
                    <span class="px-2 py-0.5 rounded-full bg-emerald-500/10 text-emerald-400 text-xs border border-emerald-500/20" id="currentDate"></span>
                </div>
                <div class="flex items-center gap-2">
                   <button class="text-xs text-sky-400 hover:underline">View Previous Visit</button>
                </div>
            </header>

            <div class="flex-1 overflow-y-auto p-4 md:p-8 scroll-smooth pb-24">
                <form id="medForm" class="max-w-5xl mx-auto space-y-6">

                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="glass-card p-4">
                            <label class="text-xs text-slate-400">Temperature (¬∞C)</label>
                            <div class="flex items-end gap-2">
                                <input type="number" step="0.1" class="bg-transparent text-2xl font-bold w-full outline-none text-white placeholder-slate-600" placeholder="00.0">
                            </div>
                        </div>
                        <div class="glass-card p-4">
                            <label class="text-xs text-slate-400">Weight (KG)</label>
                            <div class="flex items-end gap-2">
                                <input type="number" step="0.1" class="bg-transparent text-2xl font-bold w-full outline-none text-white placeholder-slate-600" placeholder="00.0" value="32.5">
                            </div>
                        </div>
                        <div class="glass-card p-4">
                            <label class="text-xs text-slate-400">Heart Rate (BPM)</label>
                            <div class="flex items-end gap-2">
                                <input type="number" class="bg-transparent text-2xl font-bold w-full outline-none text-white placeholder-slate-600" placeholder="00">
                            </div>
                        </div>
                        <div class="glass-card p-4">
                            <label class="text-xs text-slate-400">Last Meal</label>
                            <select class="bg-transparent text-lg font-medium w-full outline-none text-white mt-1">
                                <option class="text-black">Today, Morning</option>
                                <option class="text-black">Last Night</option>
                                <option class="text-black">> 24 Hours ago</option>
                            </select>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="md:col-span-2 glass-panel p-6 relative overflow-hidden group">
                            <div class="absolute top-0 right-0 p-4 opacity-50 group-hover:opacity-100 transition">
                                <button type="button" id="aiBtn" class="flex items-center gap-2 px-3 py-1.5 rounded-full bg-slate-800 border border-slate-700 text-xs text-sky-400 hover:bg-slate-700 transition">
                                    <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" /></svg>
                                    AI Scribe
                                </button>
                            </div>
                            <label class="input-label flex items-center gap-2">
                                Clinical Notes & Symptoms
                                <span class="bg-indigo-500/20 text-indigo-300 text-[10px] px-1.5 py-0.5 rounded border border-indigo-500/30">Auto-Suggest Active</span>
                            </label>
                            <textarea class="w-full bg-transparent border-none text-slate-200 resize-none focus:ring-0 h-32 leading-relaxed" placeholder="Start typing or use AI Scribe to record observations... e.g. Patient presents with lethargy and vomiting since last night."></textarea>
                        </div>

                        <div class="glass-panel p-6">
                            <label class="input-label">Diagnosis</label>
                            <div class="relative">
                                <input type="text" class="input-field pl-10" placeholder="Search ICD-10 / Common...">
                                <svg class="absolute left-3 top-3.5 w-4 h-4 text-slate-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
                            </div>
                            <div class="mt-4 space-y-2">
                                <div class="text-xs text-slate-500">Likely matches based on symptoms:</div>
                                <button type="button" class="block w-full text-left px-3 py-2 rounded-lg bg-white/5 hover:bg-white/10 text-sm text-slate-300 transition">Gastritis</button>
                                <button type="button" class="block w-full text-left px-3 py-2 rounded-lg bg-white/5 hover:bg-white/10 text-sm text-slate-300 transition">Tick Fever (Babesiosis)</button>
                            </div>
                        </div>
                    </div>

                    <div class="glass-panel p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-bold flex items-center gap-2">
                                <svg class="w-5 h-5 text-emerald-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" /></svg>
                                Prescription & Billing
                            </h3>
                            <button type="button" onclick="addMedRow()" class="px-3 py-1.5 rounded-lg bg-sky-500/10 text-sky-400 hover:bg-sky-500 hover:text-white border border-sky-500/20 text-xs font-medium transition">+ Add Item</button>
                        </div>

                        <div class="overflow-x-auto">
                            <table class="w-full text-left border-collapse">
                                <thead>
                                    <tr class="text-xs text-slate-400 border-b border-white/10">
                                        <th class="py-3 font-medium">Treatment / Medicine</th>
                                        <th class="py-3 font-medium w-32">Dosage/Freq</th>
                                        <th class="py-3 font-medium w-32">Qty</th>
                                        <th class="py-3 font-medium w-32 text-right">Cost (LKR)</th>
                                        <th class="py-3 w-10"></th>
                                    </tr>
                                </thead>
                                <tbody id="medTableBody" class="text-sm">
                                    <tr class="group border-b border-white/5">
                                        <td class="py-3 pr-2"><input type="text" class="bg-transparent w-full outline-none text-slate-200 placeholder-slate-600" placeholder="e.g. Amoxicillin" value="Consultation Fee"></td>
                                        <td class="py-3 pr-2"><input type="text" class="bg-transparent w-full outline-none text-slate-400 text-xs" disabled></td>
                                        <td class="py-3 pr-2"><input type="number" class="bg-transparent w-full outline-none text-slate-400" disabled value="1"></td>
                                        <td class="py-3 pl-2 text-right"><input type="number" class="bg-transparent w-full outline-none text-right text-emerald-400 font-mono cost-input" value="1500.00" oninput="calculateTotal()"></td>
                                        <td class="py-3 text-center"></td>
                                    </tr>
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td colspan="3" class="py-4 text-right text-slate-400 text-xs uppercase tracking-wide">Total (LKR)</td>
                                        <td class="py-4 text-right text-xl font-bold text-white font-mono" id="grandTotal">1,500.00</td>
                                        <td></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="glass-panel p-6">
                            <label class="input-label">Lab Reports / X-Rays</label>
                            <div id="drop-zone" class="border-2 border-dashed border-slate-700 rounded-xl p-6 text-center hover:border-sky-500 hover:bg-sky-500/5 transition cursor-pointer">
                                <input type="file" id="file-upload" class="hidden" multiple>
                                <svg class="w-8 h-8 mx-auto text-slate-500 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" /></svg>
                                <p class="text-xs text-slate-400">Drag files here or <span class="text-sky-400">browse</span></p>
                            </div>
                            <div id="file-preview" class="flex gap-2 mt-3 overflow-x-auto"></div>
                        </div>

                        <div class="glass-panel p-6 flex flex-col">
                            <label class="input-label">Veterinarian Signature</label>
                            <div class="flex-1 bg-white/90 rounded-xl relative overflow-hidden cursor-crosshair">
                                <canvas id="signaturePad" class="w-full h-full"></canvas>
                                <div class="absolute bottom-2 right-2 text-[10px] text-gray-400 select-none">Dr. Aravinda Perera (DVM)</div>
                            </div>
                            <button type="button" id="clearSig" class="text-[10px] text-red-400 mt-1 text-right hover:underline">Clear Signature</button>
                        </div>
                    </div>

                    <div class="flex items-center justify-end gap-4 pt-4 pb-4">
                        <div class="flex items-center gap-2 mr-auto">
                            <input type="checkbox" id="emailOwner" class="rounded bg-slate-800 border-slate-700 text-sky-500 focus:ring-0">
                            <label for="emailOwner" class="text-sm text-slate-400">Email bill & report to owner</label>
                        </div>
                        <button type="button" class="px-6 py-3 rounded-xl border border-white/10 text-slate-300 hover:bg-white/5 transition">Draft</button>
                        <button type="submit" class="px-8 py-3 rounded-xl bg-gradient-to-r from-sky-500 to-indigo-600 text-white font-semibold shadow-lg shadow-sky-500/20 hover:scale-[1.02] transition transform">Finalize Record</button>
                    </div>
                </form>
            </div>
        </main>
    </div>

    <script>
        // 1. Initial Setup
        const currentDateStr = new Date().toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit' });
        document.getElementById('currentDate').innerText = currentDateStr;

        // 2. Weight Chart (Chart.js)
        const ctx = document.getElementById('weightChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Jan', 'Mar', 'May', 'Jul', 'Sep', 'Today'],
                datasets: [{
                    label: 'Weight',
                    data: [28, 29.5, 30, 31.2, 32, 32.5],
                    borderColor: '#0ea5e9',
                    backgroundColor: 'rgba(14, 165, 233, 0.1)',
                    borderWidth: 2,
                    tension: 0.4,
                    fill: true,
                    pointRadius: 3
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    x: { display: false },
                    y: { display: false }
                }
            }
        });

        // 3. Dynamic Medicine Rows
        function addMedRow() {
            const tbody = document.getElementById('medTableBody');
            const row = document.createElement('tr');
            row.className = 'group border-b border-white/5 animate-fade-in';
            row.innerHTML = `
                <td class="py-3 pr-2"><input type="text" class="bg-transparent w-full outline-none text-slate-200 placeholder-slate-600" placeholder="Medicine Name"></td>
                <td class="py-3 pr-2"><input type="text" class="bg-transparent w-full outline-none text-slate-400 text-sm" placeholder="e.g. 50mg BID"></td>
                <td class="py-3 pr-2"><input type="number" class="bg-transparent w-full outline-none text-slate-400" value="1"></td>
                <td class="py-3 pl-2 text-right"><input type="number" class="bg-transparent w-full outline-none text-right text-emerald-400 font-mono cost-input" placeholder="0.00" oninput="calculateTotal()"></td>
                <td class="py-3 text-center"><button type="button" onclick="this.parentElement.parentElement.remove(); calculateTotal()" class="text-slate-600 hover:text-red-400">&times;</button></td>
            `;
            tbody.appendChild(row);
        }

        // 4. Billing Calculation
        function calculateTotal() {
            const inputs = document.querySelectorAll('.cost-input');
            let total = 0;
            inputs.forEach(input => {
                total += parseFloat(input.value) || 0;
            });
            document.getElementById('grandTotal').innerText = total.toLocaleString('en-LK', { minimumFractionDigits: 2 });
        }

        // 5. AI Scribe Simulation
        const aiBtn = document.getElementById('aiBtn');
        let isRecording = false;
        aiBtn.addEventListener('click', () => {
            isRecording = !isRecording;
            if (isRecording) {
                aiBtn.innerHTML = '<span class="w-2 h-2 bg-red-500 rounded-full mr-2 recording-pulse"></span> Listening...';
                aiBtn.classList.replace('text-sky-400', 'text-red-400');
                
                // Simulate typing after 2 seconds
                setTimeout(() => {
                    const textarea = document.querySelector('textarea');
                    textarea.value += " Patient shows signs of acute dermatitis. Owner reports scratching initiated after visiting Viharamahadevi Park yesterday.";
                }, 2000);
            } else {
                aiBtn.innerHTML = '<svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" /></svg> AI Scribe';
                aiBtn.classList.replace('text-red-400', 'text-sky-400');
            }
        });

        // 6. Canvas Signature Logic
        const canvas = document.getElementById('signaturePad');
        const sigCtx = canvas.getContext('2d');
        let painting = false;

        function resizeCanvas() {
            const ratio = Math.max(window.devicePixelRatio || 1, 1);
            canvas.width = canvas.offsetWidth * ratio;
            canvas.height = canvas.offsetHeight * ratio;
            sigCtx.scale(ratio, ratio);
        }
        window.addEventListener("resize", resizeCanvas);
        setTimeout(resizeCanvas, 100); // Init

        function startPosition(e) {
            painting = true;
            draw(e);
        }
        function finishedPosition() {
            painting = false;
            sigCtx.beginPath();
        }
        function draw(e) {
            if (!painting) return;
            const rect = canvas.getBoundingClientRect();
            sigCtx.lineWidth = 2;
            sigCtx.lineCap = 'round';
            sigCtx.strokeStyle = '#000';
            
            sigCtx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
            sigCtx.stroke();
            sigCtx.beginPath();
            sigCtx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
        }

        canvas.addEventListener('mousedown', startPosition);
        canvas.addEventListener('mouseup', finishedPosition);
        canvas.addEventListener('mousemove', draw);
        document.getElementById('clearSig').addEventListener('click', () => {
            sigCtx.clearRect(0, 0, canvas.width, canvas.height);
        });

        // 7. File Upload & Preview
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-upload');
        
        dropZone.onclick = () => fileInput.click();
        
        fileInput.onchange = (e) => handleFiles(e.target.files);
        
        // Handle drag/drop events
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, preventDefaults, false);
        });
        function preventDefaults(e) { e.preventDefault(); e.stopPropagation(); }
        
        dropZone.addEventListener('drop', (e) => handleFiles(e.dataTransfer.files));

        function handleFiles(files) {
            const preview = document.getElementById('file-preview');
            [...files].forEach(file => {
                const div = document.createElement('div');
                div.className = "flex-shrink-0 w-16 h-16 bg-white/10 rounded-lg flex items-center justify-center border border-white/10 relative group";
                div.innerHTML = `
                    <svg class="w-6 h-6 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
                    <button class="absolute -top-1 -right-1 bg-red-500 text-white rounded-full w-4 h-4 flex items-center justify-center text-xs opacity-0 group-hover:opacity-100 transition" onclick="this.parentElement.remove()">&times;</button>
                `;
                preview.appendChild(div);
            });
        }

        // 8. Submit Animation
        document.getElementById('medForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('button[type="submit"]');
            const originalText = btn.innerText;
            btn.innerHTML = `<svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path></svg> Processing...`;
            
            setTimeout(() => {
                btn.classList.replace('from-sky-500', 'from-emerald-500');
                btn.classList.replace('to-indigo-600', 'to-emerald-600');
                btn.innerHTML = 'Saved Successfully!';
                
                setTimeout(() => {
                    alert("Record Saved to SafePaws.lk Database!");
                    // Reset Logic here
                    btn.innerText = originalText;
                    btn.classList.replace('from-emerald-500', 'from-sky-500');
                    btn.classList.replace('to-emerald-600', 'to-indigo-600');
                }, 1000);
            }, 1500);
        });

    </script>
</body>
</html>